<script name="view-history-box-js">
let historypager = {
    "pagers": ["#cbo-subcontent-history-pager"],
    "history_row_select": "table[automationid='search-history-table'] tr[data-row-number]",
    "history_current_row": "table[automationid='search-history-table'] tr[data-row-number='~0']",
    "preview_name": "table[automationid='search-preview-table']",
    "preview_content": null,
    "set_page": function(cboId) {
        let indx = parseInt(cboId);
        if (isNaN(indx) || indx < 0 || indx > historypager.pagers.length) {
            return;
        }
        let keyname = historypager.pagers[indx];
        let pg = $(keyname).val();
        let rows = $(keyname).closest('table').find('tbody').find('tr[data-page-number]');
        rows.each(function() {
            $current = $(this);
            attr = $current.attr("data-page-number");
            hscls = $current.attr("class");
            if (typeof hscls !== typeof undefined && hscls !== false) {
                $current.removeAttr('class');
            }
            if (attr == pg) {
                $current.show()
            } else {
                $current.hide();
            }
        });
        $(keyname).blur();
    }
}

let historybox = {
    "isWorking": false,
    "controls": {
        "historylist": "dv-history-item-list",
        "preview": "dv-history-item-preview",
        "previewtemplate": "tarea-preview-html"
    },
    "getElementText": function (elementName) {
        try {
            let js = document.getElementById(elementName).innerText.trim();
            return js;
        } catch {
            return "";
        }
    },
    "preview": {
        "clear": function () {
            let html = historybox.getElementText(historybox.controls.previewtemplate);
            document.getElementById(historybox.controls.preview).innerHTML = html;
        }
    },
    "fetch": {
        "item": function (id) {
            try {
                const src = 'templates';
                const dest = 'dv-history-item-preview';
                const dv = document.getElementById(src);
                const tbl = dv.getElementsByTagName("table")[0];
                const htm = tbl.outerHTML;
                document.getElementById(dest).innerHTML = htm;
            } catch {
                historybox.preview.clear();
            }
        }
    }
}

let historylist_init = {
    "setScroll": function () {
        const selectedItem = "a[name='link-mail-items-template'].active";
        $(selectedItem).get(0).scrollIntoView();
    }
}

function fetch_item(id) {
    if (isNaN(id)) {
        return;
    }
    historybox.fetch.item(id);
}

function docReady(fn) {
    // see if DOM is already available
    if (document.readyState === "complete" || document.readyState === "interactive") {
        // call on next available tick
        setTimeout(fn, 1);
    } else {
        document.addEventListener("DOMContentLoaded", fn);
    }
}
docReady(function () {
    // historylist_init.setScroll();
});

</script>